"use strict";(self.webpackChunkphoenix_bundler=self.webpackChunkphoenix_bundler||[]).push([[792],{219:function(t,e,a){var s=a(2893),r=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.rentals.length>0,expression:"rentals.length > 0"}],staticClass:"v-tour-map"},[e("div",{staticClass:"v-tour-map_toggle",on:{click:t.openMap}},[e("img",{staticClass:"v-tour-map_toggle_bg",attrs:{src:t.$usePath("/images/map-bg.webp"),alt:""}}),t._v(" "),e("div",{staticClass:"v-tour-map_toggle_button"},[t._v("\n      Жилье на карте\n    ")])]),t._v(" "),e("fade-transition",[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isMapActive,expression:"isMapActive"}],staticClass:"v-tour-map_popup"},[e("div",{staticClass:"v-tour-map_popup_head"},[e("div",{staticClass:"v-tour-map_popup_head_logo"},[e("img",{staticClass:"v-tour-map_popup_head_logo_icon",attrs:{src:t.$usePath("/images/logo.png")}}),t._v(" "),e("div",{staticClass:"v-tour-map_popup_head_logo_title"},[t._v("Жильё на карте")])]),t._v(" "),e("div",{staticClass:"v-tour-map_close",on:{click:t.closeMap}},[e("img",{staticClass:"v-tour-map_close_icon",attrs:{src:t.$usePath("/images/close.svg"),alt:""}})])]),t._v(" "),e("div",{staticClass:"v-tour-map_popup_content"},[e("div",{staticClass:"v-tour-map_popup_list"},[t.currentRental?[e("div",{staticClass:"v-tour-map_popup_list_back",on:{click:t.resetCurrentRental}},[e("img",{staticClass:"v-tour-map_popup_list_back_icon",attrs:{src:t.$usePath("/images/arrow-back.svg"),alt:""}}),t._v("\n              Назад\n            ")]),t._v(" "),e("v-rental-card",{attrs:{rental:t.currentRental,big:"",curort:t.curort}})]:t._l(t.rentals,(function(a){return e("v-rental-card",{key:a._id,attrs:{rental:a,curort:t.curort}})}))],2),t._v(" "),e("div",{ref:"map",staticClass:"v-tour-map_popup_map"})])])]),t._v(" "),e("fade-transition",[t.currentRental?e("div",{staticClass:"v-tour-map_mobile-card"},[e("div",{staticClass:"v-tour-map_mobile-card_overlay",on:{click:t.resetCurrentRental}}),t._v(" "),e("div",{staticClass:"v-tour-map_close v-tour-map_mobile-card_close",on:{click:t.resetCurrentRental}},[e("img",{staticClass:"v-tour-map_close_icon",attrs:{src:t.$usePath("/images/close.svg"),alt:""}})]),t._v(" "),e("v-rental-card",{staticClass:"v-tour-map_mobile-card_card",attrs:{rental:t.currentRental,big:"",curort:t.curort}})],1):t._e()])],1)};r._withStripped=!0;var i=a(5221);const n=t=>String(t).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 ");var o=a(8313);const c=(t,e)=>{return`${(a=e?"от":"")?`${a} `:""}${t}${(s="₽")?` ${s}`:""}`;var a,s};var l=function(){var t=this,e=t._self._c;return e("a",{staticClass:"v-rental-card",class:{__big:t.big},attrs:{href:`/catalog/rental/${t.rental._id}?cur=${t.curort}`,target:"_blank"}},[e("img",{staticClass:"v-rental-card_image",attrs:{src:t.rental.image,alt:""}}),t._v(" "),e("div",{staticClass:"v-rental-card_content"},[e("div",{staticClass:"v-rental-card_content_head"},[e("div",{staticClass:"v-rental-card_content_head_wrap"},[e("div",{staticClass:"v-rental-card_content_title"},[t._v(t._s(t.rental.title))]),t._v(" "),t.rental.address?e("div",{staticClass:"v-rental-card_content_title_address"},[t._v("Адрес: "+t._s(t.rental.address))]):t._e(),t._v(" "),t.rental.seaDistance?e("div",{staticClass:"v-rental-card_content_title_sea-distance"},[t._v("До моря: "+t._s(t.rental.seaDistance))]):t._e(),t._v(" "),t.filteredInfra.length?e("div",{staticClass:"v-rental-card_content_infra"},t._l(t.filteredInfra,(function(a){return e("div",{key:a,staticClass:"v-rental-card_content_infra_item"},[t._v(t._s(a))])})),0):t._e(),t._v(" "),t.hasVideo||t.hasVideoTeam?e("div",{staticClass:"v-rental-card_content_tags"},[t.hasVideo?e("div",{staticClass:"v-rental-card_content_tags_item"},[t._v("Есть видео")]):t._e(),t._v(" "),t.hasVideoTeam?e("div",{staticClass:"v-rental-card_content_tags_item"},[t._v("Есть видео обзор")]):t._e()]):t._e()]),t._v(" "),e("div",{staticClass:"v-rental-card_content_side"},[e("div",{staticClass:"v-rental-card_content_price"},[t._v("от "+t._s(t._f("toPrice")(t._f("toCurrency")(t.rental.price))))]),t._v(" "),e("div",{staticClass:"v-rental-card_content_side_button"},[t._v("Подробнее")])])])])])};l._withStripped=!0;var d={props:{rental:{type:Object},big:{type:Boolean},curort:{type:String}},computed:{filteredInfra(){const t=["Автостоянка","Wifi","Бассейн","Детская площадка"];return this.rental.infra.filter((e=>t.includes(e)))},hasVideoTeam(){return this.rental.videoTeam},hasVideo(){return this.rental.video||this.rental.clips.length}}},p=a(4486),u=(0,p.A)(d,l,[],!1,null,null,null).exports,_=a(4705),v=a(2505),h=a.n(v);const m=!1;let g="";const C=document.querySelector("#site-url");C&&(g=C.dataset.url);const f=h().create({baseURL:g});class w{constructor(){var t=this;(0,_.A)(this,"get",(async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{data:s}=await t.http.get(t.getLink(e),a);return s})),(0,_.A)(this,"post",(async function(e,a){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{data:r}=await t.http.post(t.getLink(e),a,s);return r})),this.namespace="",this.isDev=m,this.http=f}getLink(t){if(/^http.*/.test(t))return t;const e=[this.namespace,...t.split("/")].filter((t=>t&&"/"!==t)).join("/");return e?`/${e}`:"/"}}var y=a(4992);const b=new y.Ay({_id:y.$l,title:y.$l,price:y.L$,location:y.Nb.of(y.L$),image:y.$l});var A=new y.Ay({list:y.Nb.of(b)},"RentalsModel");var R=new class extends w{constructor(){super(...arguments),(0,_.A)(this,"namespace","api/rentals")}async getList(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=await this.get("list",{params:t});return A.checkValue(e)}},$={components:{FadeTransition:o.AV,VRentalCard:u},data:()=>({map:null,isMapActive:!1,currentRental:null,screenWidth:0,mapBoundMargin:20,rentals:[],curort:"Адлер"}),computed:{isMobile(){return this.screenWidth<1200}},async mounted(){window.addEventListener("resize",this.setScreenWidth),this.setScreenWidth(),await this.getRentals(),this.initMap()},methods:{setCurrentRental(t){this.currentRental=t},resetCurrentRental(){this.currentRental=null},setScreenWidth(){const t=window.innerWidth;this.screenWidth=t},setCurort(){const t=new URLSearchParams(window.location.search).get("cur")||"Вардане";this.curort=t},async getRentals(){this.setCurort();const t={curort:this.curort},{list:e}=await R.getList(t);this.rentals=e},async initMap(){await new Promise((t=>{(0,i.wc)().then((()=>{window.ymaps.ready((()=>{t()}))}))}));this.map=new window.ymaps.Map(this.$refs.map,{center:this.rentals[0].location,zoom:15,controls:[]}),this.addControls(),this.map.margin.setDefaultMargin(this.mapBoundMargin),this.addRentals()},addRentals(){const t=new window.ymaps.ObjectManager({clusterize:!1,gridSize:50}),e=this.getPinLayout(),a=this.rentals.map((t=>({type:"Feature",id:t._id,geometry:{type:"Point",coordinates:t.location},properties:{_id:t._id,price:c(n(t.price))},options:{iconLayout:e}}))),s={features:a,type:"FeatureCollection"};t.add(s),t.objects.events.add("click",(e=>{const a=t.objects.getById(e.get("objectId")),s=this.rentals.find((t=>t._id===a.id));this.setCurrentRental(s)})),this.map.geoObjects.add(t)},getPinLayout:()=>window.ymaps.templateLayoutFactory.createClass('<div class="v-tour-map_pin" data-id="{{properties._id}}">\n          {{ properties.price }}\n        </div>',{getShape(){const t=this.getElement();if(!t||!t.firstElementChild)return;const e=t.firstElementChild,a=-.5*e.offsetWidth+0,s=-.5*e.offsetHeight+0;return new window.ymaps.shape.Rectangle(new window.ymaps.geometry.pixel.Rectangle([[a,s],[a+e.offsetWidth,s+e.offsetHeight]]))}}),addControls(){this.map.controls.add("zoomControl",{size:"small",position:{top:70,right:10,left:"auto"}})},async openMap(){document.body.classList.add("no-scroll"),this.isMapActive=!0,await this.$nextTick()},closeMap(){document.body.classList.remove("no-scroll"),this.isMapActive=!1}}},k=$,D=(0,p.A)(k,r,[],!1,null,null,null).exports;new IntersectionObserver(((t,e)=>{t.forEach((t=>{let{target:a,isIntersecting:s}=t;s&&((t=>{const{dataset:{lazy:e},tagName:a}=t;switch(a){case"IMG":t.setAttribute("src",e);break;case"DIV":case"A":t.setAttribute("style",`background-image: url("${e}")`)}})(a),e.unobserve(a))}))}),{rootMargin:"0px 0px 50px 0px",threshold:0});var M=a(5353);const S="RESOURCE_PATH",L="POLITICS_DOC",E="PERSONAL_DOC",P={[S]:t=>t.serviceData.path,[E]:t=>t.serviceData.personalDoc,[L]:t=>t.serviceData.politicsDoc},x="SET_RESOURCE_PATH",T="SET_AGREEMENT_DOCS",I={[x](t,e){t.serviceData.path=e},[T](t,e){let{politicsDoc:a,personalDoc:s}=e;t.serviceData.politicsDoc=a,t.serviceData.personalDoc=s}};s.Ay.use(M.Ay);const O=new M.Ay.Store({state:{serviceData:{path:"",personalDoc:"",politicsDoc:""}},getters:P,mutations:I}),V={install(t){const e=document.getElementById("resource-path");if(e){const t=e.getAttribute("data-path");O.commit(x,t)}t.mixin({computed:{...(0,M.L8)({$path:S})},methods:{$usePath(t){return`${this.$path}${t}`}}})}};s.Ay.filter("toPrice",c),s.Ay.filter("toCurrency",n),s.Ay.use(V),document.querySelectorAll(".vue-app").forEach((t=>{new s.Ay({components:{VTourMap:D},store:O}).$mount(t)}));a(6533);a(6924)()}},function(t){var e;e=219,t(t.s=e)}]);